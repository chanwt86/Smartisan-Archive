<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smartisan Icon Archive</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg:#181a1e;
      --tile:#22252b;
      --tile-size: 160px;
      --img-percent: 50%;
      --gap: 0px;
      --ratio-w:2.35;
      --ratio-h:3;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      font-family:system-ui,-apple-system,Segoe UI,Inter,sans-serif;
      color:#eaeaea}
    header{
      padding:20px;text-align:center}
    .topbar{
      height:84px;
      background:#101214;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:12px;
      padding:0 50px;
      border-bottom:1px solid var(--gridline);
      flex-wrap: nowrap;
    }
    .logo{
      width:32px;
      height:32px;
      display:block;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:inherit;
    }
    .brand svg{
      width:32px;
      height:32px;
    }
    .brand .title{
      font-size:18px;
      font-weight:600;
      letter-spacing:.2px;
    }

    .actions{
      margin-left:auto;            
      display:flex;
      align-items:center;
      gap:16px;
      flex-wrap:nowrap;    
    }

    .filters{margin-left:auto;display:flex;gap:10px}
    .filters .btn{
      height:30px;padding:0 12px;border-radius:8px;border:1px solid #3a3f46;
      background:#1a1d22;color:#cfd3d7;font-size:13px;cursor:pointer;opacity:.9;
    }
    .filters .btn:hover{opacity:1}
    .filters .btn.active{
      color:#111;background:#eaeaea;border-color:#eaeaea;box-shadow:0 0 0 3px rgba(234,234,234,.12) inset;
    }

    .search{ position:relative; margin-left:auto; }
    .search input{
      height:32px; width:200px;
      padding:0 10px 0 36px;
      border-radius:8px;
      border:1px solid #3a3f46;
      background:#1a1d22; color:#eaeaea;
      font-size:14px; outline:none; transition:all .15s;
    }
    .search input::placeholder{ color:#6b6e74; }
    .search input:focus{
      border-color:#eaeaea; background:#22252b;
      box-shadow:0 0 0 2px rgba(234,234,234,.12);
    }
    .search-icon{
      position:absolute; left:10px; top:50%; transform:translateY(-50%);
      width:16px; height:16px; color:#8b9096; pointer-events:none;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(6, var(--tile-size));
      gap: var(--gap);
      padding: 1px;
      margin: 40px auto;
      justify-content:center;
    }
    .grid .tile:nth-child(1)  { background:#3c3e43; }
    .grid .tile:nth-child(2)  { background:#43454a; }
    .grid .tile:nth-child(3)  { background:#43454a; }
    .grid .tile:nth-child(4)  { background:#33353a; }
    .grid .tile:nth-child(5)  { background:#34363c; }
    .grid .tile:nth-child(6)  { background:#303136; }

    .grid .tile:nth-child(7)  { background:#3a3c41; }
    .grid .tile:nth-child(8)  { background:#35383b; }
    .grid .tile:nth-child(9)  { background:#3f4146; }
    .grid .tile:nth-child(10) { background:#3a3c41; }
    .grid .tile:nth-child(11) { background:#35383b; }
    .grid .tile:nth-child(12) { background:#3f4146; }

    .grid .tile:nth-child(13) { background:#33353a; }
    .grid .tile:nth-child(14) { background:#34363c; }
    .grid .tile:nth-child(15) { background:#303136; }
    .grid .tile:nth-child(16) { background:#3c3e43; }
    .grid .tile:nth-child(17) { background:#43454a; }
    .grid .tile:nth-child(18) { background:#43454a; }

    .tile{
      width: 100%;
      aspect-ratio: var(--ratio-w) / var(--ratio-h);
      border: 1px solid var(--gridline);
      border-left:0;
      border-top:0;
      border-radius: 2px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.06),
        inset 0 -1px 2px rgba(0,0,0,.45);
      border: 1px solid var(--gridline);
    }
    .tile img{
      max-width: var(--img-percent) !important;
      max-height: var(--img-percent) !important;
      width: auto !important;
      height: auto !important;
      object-fit: contain;
      image-rendering: auto;
      filter: drop-shadow(0px 2px 3px rgba(0,0,0,0.69));
      transition: transform .18s cubic-bezier(.3,0,.2,1), filter .18s cubic-bezier(.3,0,.2,1);
    }
    .tile.is-empty:hover{ box-shadow:
      inset 0 1px 1px rgba(255,255,255,.08),
      inset 0 -1px 2px rgba(0,0,0,.40);
      cursor: default;
    }

    .wrap{
      overflow-x:auto; 
      padding: 0 12px;}
    .stage{
      margin: 0 auto;}
    footer{
      color:#8a8a8a;
      font-size:12px;
      text-align:center;padding:24px}

    .pager{
        display:flex; align-items:center; justify-content:center; gap:10px;
      margin:12px auto 24px;
    }
    .pager .dot{
      --dot-size:10px;
      width:var(--dot-size); height:var(--dot-size);
      border-radius:9999px;
      border:1px solid #3a3f46;
      background:#1a1d22;
      opacity:.55; padding:0; cursor:pointer;
      gap: 14px;
    }
    .pager .dot:hover{ opacity:.9; }
    .pager .dot.active{
      background:#eaeaea; border-color:#eaeaea; opacity:1;
      box-shadow:0 0 0 3px rgba(234,234,234,.12);
    }
    .pager-dots{
      display: flex;
      justify-content: center;
      gap: 14px;
    }
    .pager .jump{
      height:22px; padding:0 8px;
      border:1px solid #3a3f46; background:#1a1d22; color:#eaeaea;
      border-radius:6px; font-size:12px; cursor:pointer; opacity:.85;
    }
    .pager .jump:hover{ opacity:1; }
    .pager .jump:disabled{ opacity:.35; cursor:default; }

    @media (max-width:1200px){ .grid{ grid-template-columns: repeat(5, var(--tile-size)); } }
    @media (max-width:992px) { .grid{ grid-template-columns: repeat(4, var(--tile-size)); } }
    /* Mobile & small tablets */
    @media (max-width: 768px){
      /* Top Hero: vertical center layout */
      .topbar{
        height: auto !important;
        padding: 16px 0 !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        gap: 12px !important;
      }

      .brand{
        order:1 !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        text-align: center !important;
        margin: 0 auto !important;
      }

      .logo{
        width: 36px !important;
        height: 36px !important;
      }

      .brand .title{
        font-size: 15px !important;
        margin-top: 4px !important;
        letter-spacing: 0.2px !important;
      }

      /* Filter buttons centered */
      .filters{
        width: 100% !important;
        display: flex !important;
        justify-content: center !important;
        gap: 10px !important;
        margin-left: 0 !important;
      }
      .filters .btn{
        height: 30px !important;
        padding: 0 12px !important;
        font-size: 13px !important;
      }

      .actions{
        order: 2 !important;
        margin-left:0; 
        flex-direction:column;
        align-items:center;
        width:100%;
        gap:12px;
      }

      .search{ width:80%; margin-left:0; display:flex; justify-content:center; }
      .search input{ width:80%; max-width:260px; }


      /* Grid: Force 3 columns ALWAYS on mobile */
      .grid{
        grid-template-columns: repeat(3, 1fr) !important;
        width: 100% !important;
        margin: 24px auto 32px !important;
      }

      .tile{
        border-width: 0.5px !important;
        border-radius: 3px !important;
      }

      /* Pager closer to grid */
      .pager{
        flex-direction:column;
        align-items: center;
        gap:12px;
      }

      .pager-dots{
        display:flex;
        justify-content:center;
        gap:12px; 
        order:1;  
      }

      .pager-prev-next{
        display:flex;
        justify-content:center;
        gap:14px;
        width:100%;
        order:2; 
      }

      .pager .jump{
        min-width: 110px;
        text-align: center;
      }
  }
  </style>
</head>
  
<body>
  <header class="topbar">
    <a class="brand" href="/">
      <img class="logo" src="smartisan_logo.png" alt="Smartisan Logo">
      <span class="title">Smartisan Icon Archive</span>
    </a>

    <div class="actions">
      <div class="filters" aria-label="Filters">
        <button type="button" class="btn" data-cat="system">System Apps</button>
        <button type="button" class="btn" data-cat="third_party">Third-Party Apps</button>
      </div>

      <div class="search">
        <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 1 0-1.06 1.06l.27.28v.79l5 5 1.5-1.5-5-5zm-6 0a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9z" fill="currentColor"/>
        </svg>
        <input type="search" id="search" placeholder="Search" aria-label="Search icons">
      </div>
    </div>
  </header>

  <div class="wrap">
    <main class="stage">
      <section class="grid">
      </section>
      <nav class="pager" aria-label="Pagination">
      </nav>
    </main>
  </div>

  <footer>
    Smartisan is a registered trademark of Smartisan Technology Co., Ltd. · Non-commercial archival project.
  </footer>

  <script>
    // ========== Helpers ==========
    function shuffle(a){ const arr=a.slice(); for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr }
    function detectPageSize(){ return window.innerWidth <= 600 ? 9 : 18 }

    // ========== State ==========
    const GRID_SELECTOR = '.grid';

    let ALL_ICONS = []; 
    let currentCategory = null;
    let PAGE_SIZE = detectPageSize();

    let FILTERED = [];
    let currentOrder = []; 

    // ========== Filtering (by category + search filename) ==========
    function applyFilters(){
      const searchEl = document.getElementById('search');
      const kw = (searchEl ? searchEl.value : '').trim().toLowerCase();

      FILTERED = ALL_ICONS.filter(i => !currentCategory || i.category === currentCategory);

      if (kw){
        FILTERED = FILTERED.filter(i => i.path.split('/').pop().toLowerCase().includes(kw));
        currentOrder = FILTERED.slice().sort((a,b)=>{
          const fa = a.path.split('/').pop().toLowerCase();
          const fb = b.path.split('/').pop().toLowerCase();
          return fa.localeCompare(fb);
        });
      }else{
        currentOrder = shuffle(FILTERED);
      }
    }

    // ========== Pager ==========
    function renderPager(page, totalPages){
      const pager = document.querySelector('.pager');
      if (!pager) return;

      pager.style.display = totalPages > 1 ? 'flex' : 'none';
      pager.innerHTML = '';

      const BLOCK = 10;
      const blockStart = Math.floor((page - 1) / BLOCK) * BLOCK + 1;
      const blockEnd   = Math.min(blockStart + BLOCK - 1, totalPages);

      const dotsWrap = document.createElement('div');
      dotsWrap.className = 'pager-dots';
      for (let i = blockStart; i <= blockEnd; i++){
        const dot = document.createElement('button');
        dot.type = 'button';
        dot.className = 'dot' + (i === page ? ' active' : '');
        dot.setAttribute('aria-label', `Go to page ${i}`);
        if (i === page) dot.setAttribute('aria-current', 'page');
        dot.onclick = () => renderPage(i);
        dotsWrap.appendChild(dot);
      }

      const row = document.createElement('div');
      row.className = 'pager-prev-next';

      const mkJump = (text, go, disabled) => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'jump';
        b.textContent = text;
        b.disabled = disabled;
        if (!disabled) b.onclick = () => renderPage(go);
        return b;
      };

      const prevBlock = blockStart - BLOCK;
      const nextBlock = blockEnd + 1;
      const btnPrev10 = mkJump(window.innerWidth <= 768 ? 'Prev 10' : 'Prev 10 Pages', prevBlock, blockStart === 1);
      const btnNext10 = mkJump(window.innerWidth <= 768 ? 'Next 10' : 'Next 10 Pages', nextBlock, blockEnd === totalPages);

      row.appendChild(btnPrev10);
      row.appendChild(btnNext10);

      if (window.innerWidth > 768){
        pager.appendChild(btnPrev10);
        pager.appendChild(dotsWrap);
        pager.appendChild(btnNext10);
      } else {
        pager.appendChild(dotsWrap);
        pager.appendChild(row);
      }
    }

    // ========== Grid ==========
    function renderPage(page=1){
      const newSize = detectPageSize();
      if (newSize !== PAGE_SIZE){ PAGE_SIZE = newSize; page = 1; }


      applyFilters();

      const grid = document.querySelector(GRID_SELECTOR);
      if (!grid){ return; }

      const total = currentOrder.length;
      const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
      page = Math.min(Math.max(1, page), totalPages);
      const start = (page - 1) * PAGE_SIZE;

      const tiles = [];
      for (let i = 0; i < PAGE_SIZE; i++){
        const item = currentOrder[start + i];
        if (item){
          const alt = item.path.split('/').pop();
          tiles.push(`<div class="tile"><img src="${item.path}" alt="${alt}" loading="lazy"></div>`);
        }else{
          tiles.push(`<div class="tile is-empty" aria-hidden="true"></div>`);
        }
      }
      grid.innerHTML = tiles.join('');

      renderPager(page, totalPages);

      const url = new URL(location);
      if (totalPages > 1){
        if (page > 1) url.searchParams.set('page', String(page));
        else url.searchParams.delete('page');
      }else{
        url.searchParams.delete('page');
      }
      if (currentCategory) url.searchParams.set('category', currentCategory);
      else url.searchParams.delete('category');
      history.replaceState(null, '', url);
    }

    // ========== Category ==========
    function setFilter(cat){
      currentCategory = (currentCategory === cat) ? null : cat; 
      document.querySelectorAll('.filters .btn').forEach(btn=>{
        btn.classList.toggle('active', btn.dataset.cat === currentCategory);
      });
      renderPage(1);
    }

    // ========== Init ==========
    async function init(){
      const res = await fetch('data/icons.json', { cache:'no-cache' });
      ALL_ICONS = await res.json();

      const q = new URL(location).searchParams;
      const cat = q.get('category');
      if (cat === 'system' || cat === 'third_party') currentCategory = cat;

      document.querySelectorAll('.filters .btn').forEach(btn=>{
        btn.addEventListener('click', ()=> setFilter(btn.dataset.cat));
      });

      document.getElementById('brand-home')?.addEventListener('click',(e)=>{
        e.preventDefault();
        currentCategory = null;
        document.querySelectorAll('.filters .btn').forEach(b=>b.classList.remove('active'));

        const s = document.getElementById('search'); if (s) s.value = '';
        renderPage(1);
        history.replaceState(null, '', location.pathname); // 清掉 ?page & ?category
      });


      const searchEl = document.getElementById('search');
      if (searchEl){
        searchEl.addEventListener('input', ()=> renderPage(1));
        searchEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); renderPage(1); } });
      }

      const p = parseInt(q.get('page') || '1', 10);
      renderPage(isNaN(p)?1:p);

      window.addEventListener('popstate', ()=>{
        const q2 = new URL(location).searchParams;
        const cat2 = q2.get('category');
        currentCategory = (cat2 === 'system' || cat2 === 'third_party') ? cat2 : null;
        document.querySelectorAll('.filters .btn').forEach(btn=>{
          btn.classList.toggle('active', btn.dataset.cat === currentCategory);
        });
        const p2 = parseInt(q2.get('page') || '1', 10);
        renderPage(isNaN(p2)?1:p2);
      });

      window.addEventListener('resize', ()=>{
        const newSize = detectPageSize();
        if (newSize !== PAGE_SIZE){
          PAGE_SIZE = newSize;
          renderPage(1);
        }
      });
    }
    init();
  </script>
</body>
</html>